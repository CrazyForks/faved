<VirtualHost *:80>
    ServerName faved

    DocumentRoot "/var/www/html/public"

    <IfModule xsendfile_module>
        XSendFilePath "/var/www/html/public"
    </IfModule>

    # Redirect 'db' prefixed path to document root using mod_rewrite
    <IfModule mod_rewrite.c>
        RewriteEngine On
        RewriteRule ^/db([a-zA-Z0-9]{64})/?$ /index.php [L]
        RewriteRule ^/db([a-zA-Z0-9]{64})/(.+)$ /$2 [L]
    </IfModule>

    # Set environment variable for database name based on the URL
    SetEnvIf Request_URI "^/db([a-zA-Z0-9]{64})(.*)" DB_NAME=$1

    <Directory "/var/www/html/public">
        Options Includes FollowSymLinks ExecCGI
        AllowOverride All
        <IfModule authz_host_module>
            Order allow,deny
            Allow from all
        </IfModule>
    </Directory>
</VirtualHost>
